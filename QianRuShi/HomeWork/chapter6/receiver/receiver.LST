C51 COMPILER V7.50   RECEIVER                                                              05/08/2012 18:22:17 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE RECEIVER
OBJECT MODULE PLACED IN receiver.OBJ
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE receiver.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<REG52.H>
   2          #include<stdio.h>
   3          
   4          //use the timer1 work at 19200 baud and mode is 2 with even parity 
   5          void initUart( void );
   6          
   7          unsigned char receiveByte( void );
   8          
   9          unsigned char xdata xArrayAt4000[0xFF + 1] _at_ 0x4000;
  10          
  11          int main( void )
  12          {
  13   1              unsigned long c;
  14   1              unsigned char recByte;
  15   1      
  16   1              initUart();
  17   1      
  18   1              //wait to receive data
  19   1              c = 0;
  20   1              RI = 0;
  21   1              while( 1 )
  22   1              {
  23   2                      recByte = receiveByte();
  24   2                      xArrayAt4000[c++] = recByte;
  25   2              }
  26   1      
  27   1              return 0;
  28   1      }
  29          
  30          //use timer1 @mode2
  31          void initUart( void )
  32          {
  33   1              TMOD = 0x20;
  34   1              PCON = 0x80;
  35   1              TH1 = TL1 = 0xFD;
  36   1              SM0 = 1;
  37   1              SM1 = 1;
  38   1              SM2 = 0;
  39   1              REN = 1;
  40   1      
  41   1              TR1 = 1;
  42   1      
  43   1              TI = 1; //to get the printf work
  44   1      
  45   1      }
  46          
  47          unsigned char receiveByte( void )
  48          {
  49   1              unsigned char rec;
  50   1              unsigned char sc;
  51   1              unsigned char cnt;
  52   1              bit rb;
  53   1      
  54   1              while( !RI );
  55   1              RI = 0;
C51 COMPILER V7.50   RECEIVER                                                              05/08/2012 18:22:17 PAGE 2   

  56   1              
  57   1      
  58   1              rb = RB8;
  59   1              rec = SBUF;
  60   1      
  61   1      
  62   1      
  63   1              sc = 0;
  64   1              for( cnt=0 ; cnt<8 ; cnt++ )
  65   1              {
  66   2                      sc += ( rec>>cnt ) & 0x01;
  67   2              }
  68   1      
  69   1              if( rb )
  70   1                      sc++;
  71   1              
  72   1              if( ( sc % 2  ) != 0 )
  73   1              {
  74   2                      //printf("Receive error!! even parity fail\n");
  75   2                      return 0xff;
  76   2              }
  77   1      
  78   1              
  79   1              return rec;
  80   1      }
  81          
  82          
  83          
  84          
  85          
  86          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    107    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
