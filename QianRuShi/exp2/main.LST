C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:20:14 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<REG52.H>
   2          #include<intrins.h>
   3          
   4          //Global define switches to control the program behavior to satified the needs.
   5          #define USE_MODULE1 0 
   6          #define USE_MODULE2 1
   7          #define USE_MODULE3 0
   8          
   9          #if ( USE_MODULE1 + USE_MODULE2 + USE_MODULE3 ) > 1 || ( USE_MODULE1 + USE_MODULE2 + USE_MODULE3 ) == 0
              #error "error of switches. Try to modify the USE_MODULE1 or USE_MODULE2 or USE_MODULE3" // 001 010 100 is 
             -acceptable
              #endif
  12          
  13          #define LED_PORT1 P1
  14          #define DEAY_MS 150
  15          
  16          
  17          //delay function, no timer engaged which means it's inaccurate.
  18          void delay( unsigned int ucMs );
  19          
  20          
  21          //module 1 entrance
  22          #if USE_MODULE1
              
              int main( void )
              {
              
                      unsigned char cycle;
                      unsigned char ledStatus;
              
                      //choose the external trigger mode
                      IT1 = 0; //Can we use bit addressing? It's 88H. Now that int0 int1 are edage trigger
                      IT0 = 1; //Try it. Man
              
                      //external interrupt enable
                      EX0 = 1; //external 0 allowed
                      EX1 = 1; //external 1 allowed
              
                      //global interrupt enable
                      EA = 1;  //Global interrupt on!
              
                      //initial off all the leds
                      P0 = 0xFF;
                      P2 = 0xFF;
                      LED_PORT1 = 0xFF;
              
                      while( 1 )
                      {
                              ledStatus = 0x01;
                              LED_PORT1 = ~ledStatus;
                              delay( DEAY_MS );
              
                              for( cycle=1 ; cycle<8 ; cycle++ )
                              {
                                      ledStatus <<=1;
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:20:14 PAGE 2   

                                      LED_PORT1 =~ledStatus;
                                      delay( DEAY_MS );
                              }
              
                      }
              
              
                      return 0;
              }
              
              #endif
  66          
  67          
  68          //module 2 entrance
  69          #if USE_MODULE2
  70          
  71          bit mode;                  //evil global variable, indicate the mode we use here
  72          unsigned long ledStatus;   //We handle with care, But is there a risk of race like that in Operaton System
             -?
  73          
  74          int main( void )
  75          {
  76   1              //choose the external trigger mode
  77   1              //IT1 = 0; //Can we use bit addressing? It's 88H. Now that int0 int1 are edage trigger
  78   1              IT0 = 1; //Try it. Man
  79   1      
  80   1              //external interrupt enable
  81   1              EX0 = 1; //external 0 allowed
  82   1              //EX1 = 1; //external 1 allowed
  83   1      
  84   1              //global interrupt enable
  85   1              EA = 1;  //Global interrupt on!
  86   1              
  87   1      
  88   1              //initial off all the leds
  89   1              P0 = 0xFF;
  90   1              P2 = 0xFF;
  91   1              LED_PORT1 = 0xFF;
  92   1      
  93   1              ledStatus = 0x01;
  94   1              mode = 0;
  95   1              LED_PORT1 = ~ledStatus;
  96   1              delay( DEAY_MS );
  97   1      
  98   1              while( 1 )
  99   1              {
 100   2                  ledStatus = _crol_( ledStatus , 1 + ( unsigned char )mode );          //C51 libary provide a lot of useful f
             -unction. Shall Google it...
 101   2                      LED_PORT1 =~ledStatus;
 102   2                      delay( DEAY_MS );
 103   2              }
 104   1      
 105   1              return 0;
 106   1      }
 107          
 108          #endif
 109                  
 110          
 111          
 112          
 113          //a delay function
 114          void delay( unsigned int ucMs )
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:20:14 PAGE 3   

 115          {
 116   1      //running at 11.0592MHz ?
 117   1      #define DELAYTIMES 239 
 118   1      
 119   1              unsigned char ucCounter;
 120   1      
 121   1              while( ucMs != 0 )
 122   1              {
 123   2                      for( ucCounter=0; ucCounter < DELAYTIMES ; ucCounter ++ ){}
 124   2                      ucMs--;
 125   2              }
 126   1      }
 127          
 128          
 129          #if USE_MODULE1
              
              //external 0 interrupt edge trigger no need to clear the interrupt bit
              void ext0( void ) interrupt 0
              {
                  unsigned char c;
              
                      EA = 0; //no interrupt me
              
                      for( c=0 ; c<3 ; c++ )
                      {
                              P0 = 0xF0;
                              delay( DEAY_MS );
                              P0 = 0xFF;
                              delay( DEAY_MS );
                      }
                      
                      EA = 1; //interrupt on
              }
              
              //external 1 interrupt edge trigger no need to clear the interrupt bit
              void ext1( void ) interrupt 2
              {
                      unsigned char c;
              
                      EA = 0; //no interrupt me
              
                      for( c=0 ; c<6 ; c++ )
                      {
                              P2 = 0xF0;
                              delay( 50 );
                              P2 = 0xFF;
                              delay( DEAY_MS );
              
                      }
              
              
                      EA = 1; //interrupt on
              }
              
              #endif
 170          
 171          #if USE_MODULE2
 172          
 173          //external 0 interrupt edge trigger no need to clrea the interrupt bit
 174          void etx0( void ) interrupt 0
 175          {
 176   1              EA = 0; //no interrupt me
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:20:14 PAGE 4   

 177   1      
 178   1              if( mode )   // mode == 1 means current is two leds, next status one led
 179   1              {
 180   2                      ledStatus = ledStatus & _crol_( ledStatus , 1 ) ;      //must use the  char rotate in a circle style
 181   2              }
 182   1              else         // mode == 0 means current is one led, next status two leds
 183   1              {
 184   2                      ledStatus = ledStatus | _crol_( ledStatus , 1 ) ;      //must use the char rotate to get a circle
 185   2              }
 186   1      
 187   1              mode = ~mode;
 188   1      
 189   1              EA = 1; //global interrupt on again
 190   1      }
 191          
 192          #endif
 193          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    178    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
