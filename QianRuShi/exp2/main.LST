C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:08:17 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<REG52.H>
   2          #include<intrins.h>
   3          
   4          //Global define switches to control the program behavior to satified the needs.
   5          #define USE_MODULE1 0 
   6          #define USE_MODULE2 1
   7          #define USE_MODULE3 0
   8          
   9          #if ( USE_MODULE1 + USE_MODULE2 + USE_MODULE3 ) > 1 || ( USE_MODULE1 + USE_MODULE2 + USE_MODULE3 ) == 0
              #error "error of switches. Try to modify the USE_MODULE1 or USE_MODULE2 or USE_MODULE3" // 001 010 100 is 
             -acceptable
              #endif
  12          
  13          #define LED_PORT1 P1
  14          #define DEAY_MS 150
  15          
  16          
  17          //delay function, no timer engaged which means it's inaccurate.
  18          void delay( unsigned int ucMs );
  19          
  20          
  21          //module 1 entrance
  22          #if USE_MODULE1
              
              int main( void )
              {
              
                      unsigned char cycle;
                      unsigned char ledStatus;
              
                      //choose the external trigger mode
                      IT1 = 0; //Can we use bit addressing? It's 88H. Now that int0 int1 are edage trigger
                      IT0 = 1; //Try it. Man
              
                      //external interrupt enable
                      EX0 = 1; //external 0 allowed
                      EX1 = 1; //external 1 allowed
              
                      //global interrupt enable
                      EA = 1;  //Global interrupt on!
              
                      while( 1 )
                      {
                              ledStatus = 0x01;
                              LED_PORT1 = ~ledStatus;
                              delay( DEAY_MS );
              
                              for( cycle=1 ; cycle<8 ; cycle++ )
                              {
                                      ledStatus <<=1;
                                      LED_PORT1 =~ledStatus;
                                      delay( DEAY_MS );
                              }
              
                      }
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:08:17 PAGE 2   

              
              
                      return 0;
              }
              
              #endif
  61          
  62          
  63          //module 2 entrance
  64          #if USE_MODULE2
  65          
  66          bit mode;                  //evil global variable, indicate the mode we use here
  67          unsigned long ledStatus;   //We handle with care, But is there a risk of race like that in Operaton System
             -?
  68          
  69          int main( void )
  70          {
  71   1              //choose the external trigger mode
  72   1              //IT1 = 0; //Can we use bit addressing? It's 88H. Now that int0 int1 are edage trigger
  73   1              IT0 = 1; //Try it. Man
  74   1      
  75   1              //external interrupt enable
  76   1              EX0 = 1; //external 0 allowed
  77   1              //EX1 = 1; //external 1 allowed
  78   1      
  79   1              //global interrupt enable
  80   1              EA = 1;  //Global interrupt on!
  81   1      
  82   1              ledStatus = 0x01;
  83   1              mode = 0;
  84   1              LED_PORT1 = ~ledStatus;
  85   1              delay( DEAY_MS );
  86   1      
  87   1              while( 1 )
  88   1              {
  89   2                  ledStatus = _crol_( ledStatus , 1 + ( unsigned char )mode );          //C51 libary provide a lot of useful f
             -unction. Shall Google it...
  90   2                      LED_PORT1 =~ledStatus;
  91   2                      delay( DEAY_MS );
  92   2              }
  93   1      
  94   1              return 0;
  95   1      }
  96          
  97          #endif
  98                  
  99          
 100          
 101          
 102          //a delay function
 103          void delay( unsigned int ucMs )
 104          {
 105   1      //running at 11.0592MHz ?
 106   1      #define DELAYTIMES 239 
 107   1      
 108   1              unsigned char ucCounter;
 109   1      
 110   1              while( ucMs != 0 )
 111   1              {
 112   2                      for( ucCounter=0; ucCounter < DELAYTIMES ; ucCounter ++ ){}
 113   2                      ucMs--;
 114   2              }
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 11:08:17 PAGE 3   

 115   1      }
 116          
 117          
 118          #if USE_MODULE1
              
              //external 0 interrupt edge trigger no need to clear the interrupt bit
              void ext0( void ) interrupt 0
              {
                  unsigned char c;
              
                      EA = 0; //no interrupt me
              
                      for( c=0 ; c<3 ; c++ )
                      {
                              P0 = 0xF0;
                              delay( DEAY_MS );
                              P0 = 0xFF;
                              delay( DEAY_MS );
                      }
                      
                      EA = 1; //interrupt on
              }
              
              //external 1 interrupt edge trigger no need to clear the interrupt bit
              void ext1( void ) interrupt 2
              {
                      unsigned char c;
              
                      EA = 0; //no interrupt me
              
                      for( c=0 ; c<6 ; c++ )
                      {
                              P2 = 0xF0;
                              delay( 50 );
                              P2 = 0xFF;
                              delay( DEAY_MS );
              
                      }
              
              
                      EA = 1; //interrupt on
              }
              
              #endif
 159          
 160          #if USE_MODULE2
 161          
 162          #endif
 163          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     85    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
