C51 COMPILER V7.50   MAIN                                                                  05/10/2012 21:16:31 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<REG52.H>
   2          #include<IMSutil.h>
   3          
   4          #define RUNNING_COUNTER 1
   5          #define BASKETBALL_COUNTER 0
   6          #define KEY_FILTER_MS 2
   7          
   8          #define RUNNING_INITIAL_10MS 0  
   9          #define BASKETBALL_ROUND_TIMEUP_10MS 12*60*100 //12 minutes
  10          
  11          #define MINUTE_LED P3
  12          #define SECOND_LED P2
  13          #define MICRO_10MS_LED P1
  14          
  15          sbit bStart = P0^0;
  16          sbit bPauseContinue = P0^1;
  17          sbit outPut = P0^7;
  18          bit running;
  19          
  20          sbit bClear = P0^2;
  21          sbit bExit = P0^3;
  22          
  23          #if RUNNING_COUNTER 
  24          //unsigned long is 32 bit...good
  25          volatile unsigned long currentTicksIn10ms;
  26          
  27          //set the timer 2 interrupt at every 10ms
  28          void setTimer2_10ms( void );
  29          
  30          //update the 7-SEG led using the global ticks
  31          void update7SEG( void );
  32          
  33          int main( void )
  34          {
  35   1              running = 0;
  36   1              outPut = 1;
  37   1              currentTicksIn10ms = RUNNING_INITIAL_10MS;
  38   1              update7SEG();
  39   1      
  40   1              setTimer2_10ms();
  41   1      
  42   1              EA = 1;
  43   1              while( 1 )
  44   1              {
  45   2                      if( ! bStart )
  46   2                      {
  47   3                              delay_ms( KEY_FILTER_MS );
  48   3                              if( ! bStart ) //the button is on !!
  49   3                              {
  50   4                                      while( ! bStart );
  51   4                                      running = 1;
  52   4                              }
  53   3                      }
  54   2      
  55   2                      if( ! bPauseContinue )
C51 COMPILER V7.50   MAIN                                                                  05/10/2012 21:16:31 PAGE 2   

  56   2                      {
  57   3                              delay_ms( KEY_FILTER_MS );
  58   3                              if( ! bPauseContinue ) //the button is on !!
  59   3                              {
  60   4                                      while( ! bPauseContinue );
  61   4                                      running = ~running;
  62   4                              }
  63   3                      }
  64   2      
  65   2                      if( ! bClear )
  66   2                      {
  67   3                              delay_ms( KEY_FILTER_MS );
  68   3                              if( ! bClear ) //the button is on !!
  69   3                              {
  70   4                                      EA = 0;
  71   4                                      while( ! bClear );
  72   4                                      currentTicksIn10ms = RUNNING_INITIAL_10MS;
  73   4                                      update7SEG();
  74   4                                      EA = 1;
  75   4                              }
  76   3                      }
  77   2              }
  78   1              
  79   1              return 0;
  80   1      }
  81          
  82          //timer 2 interrupt routine
  83          void timer2Interrupt( void ) interrupt 5
  84          {
  85   1              EA = 0;
  86   1              TF2 = 0;
  87   1      
  88   1              if( running )
  89   1              {
  90   2                      currentTicksIn10ms ++;
  91   2                      update7SEG();
  92   2              }
  93   1              
  94   1              outPut = ~outPut;
  95   1              EA = 1;
  96   1      }
  97          
  98          //set the timer 
  99          void setTimer2_10ms( void )
 100          {
 101   1              T2CON = 0x00;
 102   1              TH2 = RCAP2H = 0xD8 ;   //run at 12MHz at 1us percycle 65536 - 10000 
 103   1              TL2 = RCAP2L = 0xF0 ;
 104   1      
 105   1              ET2 = 1;  //enable the timer 2 interrupt
 106   1              TR2 = 1;  //start the timer     
 107   1      }
 108          
 109          void update7SEG( void )
 110          {
 111   1              unsigned char min;
 112   1              unsigned char sec;
 113   1              unsigned char ms10;
 114   1      
 115   1              min = currentTicksIn10ms / ( 1 * 60 * 100 );
 116   1              sec =( currentTicksIn10ms - ( 1 * 60 * 100 * min ) ) / ( 100 );
 117   1              ms10 = currentTicksIn10ms - ( 1 * 60 * 100 * min ) - 100 * sec;
C51 COMPILER V7.50   MAIN                                                                  05/10/2012 21:16:31 PAGE 3   

 118   1      
 119   1              MINUTE_LED = ( (min/10) *16 + (min%10) ); 
 120   1              SECOND_LED = ( (sec/10) *16 + (sec%10) );
 121   1              MICRO_10MS_LED = ( (ms10/10) *16 + (ms10%10) );
 122   1      
 123   1      }
 124          
 125          #endif 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    337    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
