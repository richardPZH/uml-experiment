C51 COMPILER V7.50   MAIN                                                                  04/18/2012 10:51:44 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<REG52.H>
   2          #include<intrins.h>
   3          
   4          //Global define switches to control the program behavior to satified the needs.
   5          #define USE_MODULE1 1 
   6          #define USE_MODULE2 0
   7          #define USE_MODULE3 0
   8          
   9          #if USE_MODULE1 
  10          #error "error of switches..."
*** ERROR C320 IN LINE 10 OF main.c: "error of switches..."
  11          #endif
  12          
  13          #define LED_PORT1 P1
  14          
  15          #define DEAY_MS 150
  16          
  17          
  18          //delay function, no timer engaged which means it's inaccurate.
  19          void delay( unsigned int ucMs );
  20          
  21          int main( void )
  22          {
  23   1      
  24   1              unsigned char cycle;
  25   1              unsigned char ledStatus;
  26   1      
  27   1      
  28   1              //module 1 entrance
  29   1      #if USE_MODULE1
  30   1      
  31   1              //choose the external trigger mode
  32   1              IT1 = 0; //Can we use bit addressing? It's 88H. Now that int0 int1 are edage trigger
  33   1              IT0 = 1; //Try it. Man
  34   1      
  35   1              //external interrupt enable
  36   1              EX0 = 1; //external 0 allowed
  37   1              EX1 = 1; //external 1 allowed
  38   1      
  39   1              //global interrupt enable
  40   1              EA = 1;  //Global interrupt on!
  41   1      
  42   1              while( 1 )
  43   1              {
  44   2                      ledStatus = 0x01;
  45   2                      LED_PORT1 = ~ledStatus;
  46   2                      delay( DEAY_MS );
  47   2      
  48   2                      for( cycle=1 ; cycle<8 ; cycle++ )
  49   2                      {
  50   3                              ledStatus <<=1;
  51   3                              LED_PORT1 =~ledStatus;
  52   3                              delay( DEAY_MS );
  53   3                      }
  54   2      
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 10:51:44 PAGE 2   

  55   2              }
  56   1      
  57   1      #endif
  58   1      
  59   1              //module 2 entrance
  60   1      #if USE_MODULE2
              
                      //choose the external trigger mode
                      //IT1 = 0; //Can we use bit addressing? It's 88H. Now that int0 int1 are edage trigger
                      IT0 = 1; //Try it. Man
              
                      //external interrupt enable
                      EX0 = 1; //external 0 allowed
                      //EX1 = 1; //external 1 allowed
              
                      //global interrupt enable
                      EA = 1;  //Global interrupt on!
              
                      ledStatus = 0x01;
                      LED_PORT1 = ~ledStatus;
                      delay( DEAY_MS );
              
                      while( 1 )
                      {
              
                              for( cycle=1 ; cycle<8 ; cycle++ )
                              {
                                  ledStatus = crol( ledStatus , 1 );  
                                      LED_PORT1 =~ledStatus;
                                      delay( DEAY_MS );
                              }
              
                      }
              #endif
  89   1              
  90   1      
  91   1      
  92   1              return 0;
  93   1      }
  94          
  95          
  96          //a delay function
  97          void delay( unsigned int ucMs )
  98          {
  99   1      //running at 11.0592MHz ?
 100   1      #define DELAYTIMES 239 
 101   1      
 102   1              unsigned char ucCounter;
 103   1      
 104   1              while( ucMs != 0 )
 105   1              {
 106   2                      for( ucCounter=0; ucCounter < DELAYTIMES ; ucCounter ++ ){}
 107   2                      ucMs--;
 108   2              }
 109   1      }
 110          
 111          
 112          #if USE_MODULE1
 113          
 114          //external 0 interrupt edge trigger no need to clear the interrupt bit
 115          void ext0( void ) interrupt 0
 116          {
C51 COMPILER V7.50   MAIN                                                                  04/18/2012 10:51:44 PAGE 3   

 117   1          unsigned char c;
 118   1      
 119   1              EA = 0; //no interrupt me
 120   1      
 121   1              for( c=0 ; c<3 ; c++ )
 122   1              {
 123   2                      P0 = 0xF0;
 124   2                      delay( DEAY_MS );
 125   2                      P0 = 0xFF;
 126   2                      delay( DEAY_MS );
 127   2              }
 128   1              
 129   1              EA = 1; //interrupt on
 130   1      }
 131          
 132          //external 1 interrupt edge trigger no need to clear the interrupt bit
 133          void ext1( void ) interrupt 2
 134          {
 135   1              unsigned char c;
 136   1      
 137   1              EA = 0; //no interrupt me
 138   1      
 139   1              for( c=0 ; c<6 ; c++ )
 140   1              {
 141   2                      P2 = 0xF0;
 142   2                      delay( 50 );
 143   2                      P2 = 0xFF;
 144   2                      delay( DEAY_MS );
 145   2      
 146   2              }
 147   1      
 148   1      
 149   1              EA = 1; //interrupt on
 150   1      }
 151          
 152          #endif
 153          
 154          #if USE_MODULE2
              
              #endif
 157          

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
